        <div class="title">PWM</div>
        <div class="step-block">
            <ul>
               <li><div class="text">En esta lección vamos a ver cómo funciona el timer <b>TIM1</b> en modo salida PWM.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/26.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">Vamos a generar una señal de PWM de período 100us y <b>duty cycle</b> de 25%.</div></li>
               <li><div class="text">El registro <b>ARR</b> (Auto-reload) va a ser el período - 1, es decir, 99.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/27.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">El registro <b>CCR1</b> va a ser el <b>duty cycle</b>, como queremos que sea el 25% será 25.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/28.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">El registro <b>CNT</b> (contador) va a incrementarse ascendentemente de 0 a 99.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/29.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">La señal de salida PWM va a salir por el pin <b>TIM1_CH1</b>, que será el PA8.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/30.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">En cada ciclo de reloj el contador <b>CNT</b> se incrementa en 1.</div></li>
               <li><div class="text">Mientras el registro <b>CNT</b> sea menor que el registro <b>CCR1</b> la salida estará a nivel alto.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/31.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/32.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/33.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/34.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">Si el registro <b>CNT</b> es mayor o igual que el registro <b>CCR1</b> la salida estará a nivel bajo.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/35.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/36.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/37.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/38.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">Y así sucesivamente.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/39.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/40.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/41.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/42.png">
        </div>
        <div class="title">Pasos</div>
        <div class="step-block">
            <ul>
               <li><div class="text">Crea un proyecto nuevo basado en el kit de evaluación y llámalo <b>P21_TIM1_PWM</b>.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/01.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/02.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/03.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/04.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/05.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/06.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">La salida PWM del timer 1 es <b>TIM1_CH1</b> que está en el pin <b>PA8</b>.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/07.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/08.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">Genera el código de inicialización.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/09.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/10.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">Ve al fichero <b>main.c</b></div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/11.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">La función <b>MX_GPIO_INIT</b> inicializa el pin <b>PA8</b> para que sea la salida de PWM del timer 1.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/12.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/13.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/14.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">Este es el código que voy a añadir para configurar el timer 1 en modo salida PWM.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/15.png">
            <table class="source-code-table">
                  <tr>
                      <td>99</td>
                      <td>  /* Infinite loop */</td>
                  </tr>
                  <tr>
                      <td>100</td>
                      <td>  /* USER CODE BEGIN WHILE */</td>
                  </tr>
                  <tr>
                      <td>101</td>
                      <td>  //Enable clock for TIM1</td>
                  </tr>
                  <tr>
                      <td>102</td>
                      <td>  <span class="b1">RCC-&gtAPB2ENR    |=    RCC_APB2ENR_TIM1EN<span class="tooltiptext">Habilita el reloj del <b>TIM1</b></span></span>;</td>
                  </tr>
                  <tr>
                      <td>103</td>
                      <td></td>
                  </tr>
                  <tr>
                      <td>104</td>
                      <td>  //Disable TIM1</td>
                  </tr>
                  <tr>
                      <td>105</td>
                      <td>  <span class="b2">TIM1-&gtCR1       =    0<span class="tooltiptext">Deshabilita el timer para poder configurarlo.</span></span>;            </td>
                  </tr>
                  <tr>
                      <td>106</td>
                      <td></td>
                  </tr>
                  <tr>
                      <td>107</td>
                      <td>  //Disable all TIM1 interrupts</td>
                  </tr>
                  <tr>
                      <td>108</td>
                      <td>  <span class="b3">TIM1-&gtDIER      =    0<span class="tooltiptext">Deshabilita las interrupciones del <b>TIM1</b></span></span>;</td>
                  </tr>
                  <tr>
                      <td>109</td>
                      <td></td>
                  </tr>
                  <tr>
                      <td>110</td>
                      <td>  //Configure prescaler to have 1MHz clock frequency</td>
                  </tr>
                  <tr>
                      <td>111</td>
                      <td>  <span class="b4">TIM1-&gtPSC       =    47<span class="tooltiptext">Establece un prescaler de 48, obteniendo así un reloj de 1MHz.</span></span>;                        </td>
                  </tr>
                  <tr>
                      <td>112</td>
                      <td></td>
                  </tr>
                  <tr>
                      <td>113</td>
                      <td>  <span class="b5">TIM1-&gtARR       =    99<span class="tooltiptext">El período del PWM es de 99 + 1 = 100 us.</span></span>;                        </td>
                  </tr>
                  <tr>
                      <td>114</td>
                      <td>  <span class="b6">TIM1-&gtCCR1      =    25<span class="tooltiptext">El duty cycle es de 25us.</span></span>;                        </td>
                  </tr>
                  <tr>
                      <td>115</td>
                      <td>  <span class="b1">TIM1-&gtCCMR1<span class="tooltiptext">Configuramos el timer en modo PWM.</span></span>     =    TIM_CCMR1_OC1M_2 |        </td>
                  </tr>
                  <tr>
                      <td>116</td>
                      <td>                       TIM_CCMR1_OC1M_1 |        </td>
                  </tr>
                  <tr>
                      <td>117</td>
                      <td>                       TIM_CCMR1_OC1PE;        </td>
                  </tr>
                  <tr>
                      <td>118</td>
                      <td>  <span class="b2">TIM1-&gtCCER      =    TIM_CCER_CC1E<span class="tooltiptext">El timer es configurado como salida</span></span>;         </td>
                  </tr>
                  <tr>
                      <td>119</td>
                      <td>  <span class="b3">TIM1-&gtBDTR      =    TIM_BDTR_MOE<span class="tooltiptext">Habilita la salida del timer.</span></span>;       </td>
                  </tr>
                  <tr>
                      <td>120</td>
                      <td></td>
                  </tr>
                  <tr>
                      <td>121</td>
                      <td>  <span class="b4">TIM1-&gtCR1       =    TIM_CR1_CEN<span class="tooltiptext">Habilita el timer.</span></span>;            </td>
                  </tr>
                  <tr>
                      <td>122</td>
                      <td>  <span class="b5">TIM1-&gtEGR       =    TIM_EGR_UG<span class="tooltiptext">Fuerza un evento de update para comenzar el PWM.</span></span>;     </td>
                  </tr>
                  <tr>
                      <td>123</td>
                      <td></td>
                  </tr>
                  <tr>
                      <td>124</td>
                      <td>  while (1)</td>
                  </tr>
                  <tr>
                      <td>125</td>
                      <td>  {</td>
                  </tr>
                  <tr>
                      <td>126</td>
                      <td>    /* USER CODE END WHILE */</td>
                  </tr>
                  <tr>
                      <td>127</td>
                      <td></td>
                  </tr>
                  <tr>
                      <td>128</td>
                      <td>    /* USER CODE BEGIN 3 */</td>
                  </tr>
                  <tr>
                      <td>129</td>
                      <td>  }</td>
                  </tr>
                  <tr>
                      <td>130</td>
                      <td>  /* USER CODE END 3 */</td>
                  </tr>
                  <tr>
                      <td>131</td>
                      <td>}</td>
                  </tr>
                  <tr>
                      <td>132</td>
                      <td></td>
                  </tr>
            </table>
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">Veamos el registro CCMR1.</div></li>
               <li><div class="text">El campo <b>OC1M</b> debe valer <b>110</b> para configurar el timer en modo PWM.</div></li>
               <li><div class="text">El bit <b>OC1PE</b> a 1 habilita los registros <b>shadow</b> haciendo que las escrituras en los registros se sincronicen al comienzo del período.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/19.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">El bit <b>CC1E</b> del registro <b>CCER</b> a 1 configura el timer como salida.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/21.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">El bit <b>MOE</b> del registro <b>BDTR</b> a 1 habilita la salida del timer.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/23.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">El bit <b>UG</b> del registro <b>EGR</b> fuerza un evento de update para comenzar el PWM.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/25.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">Compila y depura el programa.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/43.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/44.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/45.png">
        </div>
        <div class="step-block">
            <ul>
               <li><div class="text">Aquí puedes ver la conexión del kit de evaluación al osciloscopio y la señal PWM generada.</div></li>
            </ul>
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/47.png">
            <img class="img" src="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/img/46.png">
        </div>
        <div class="section">Descargas</div>
        <div class="step-block">
            <ul>
               <li><a target="_blank" href="../courses/04_STM32F0/Seccion06/L41_TIM1_PWM/downloads/L41_HW_Connections.pdf">Conexiones HW</a></li>
            </ul>
        </div>
